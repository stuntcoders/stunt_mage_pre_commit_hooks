#!/usr/bin/env bash

# Check for leftover debug code in PHP & JS files
FILES_PATTERN='\.(php|phtml|js)(\..+)?$'
FORBIDDENS=('var_dump' 'Zend_Debug' 'console.log')

RETURN_VAL=0
for FORBIDDEN in ${FORBIDDENS[@]}; do
	VAL=$(git diff-index --cached --name-only HEAD | \
	grep -E '\.(php|phtml|js)(\..+)?$' | \
	GREP_COLOR='4;5;37;41' xargs grep --color --with-filename -n $FORBIDDEN)

	if [ "$VAL" != "" ]; then
		echo "Debug call detected: $VAL"
		RETURN_VAL=1
	fi
done

exit $RETURN_VAL
